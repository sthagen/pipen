
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.2.2">
    
    
      
        <title>Channels - pipen</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1118c9be.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ba0d045b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    
      <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    
      <link rel="stylesheet" href="../css/mkapi-common.css">
    
      <link rel="stylesheet" href="../style.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#creating-channels" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="pipen" class="md-header__button md-logo" aria-label="pipen" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pipen
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Channels
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/pwwang/pipen/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pwwang/pipen
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="pipen" class="md-nav__button md-logo" aria-label="pipen" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    pipen
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/pwwang/pipen/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pwwang/pipen
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../basics/" class="md-nav__link">
        Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../defining-proc/" class="md-nav__link">
        Defining a process
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../running/" class="md-nav__link">
        Defining and running a pipeline
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../templating/" class="md-nav__link">
        Templating
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Channels
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Channels
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creating-channels" class="md-nav__link">
    Creating channels
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#builtin-verbsfunctions-to-transform-channels" class="md-nav__link">
    Builtin verbs/functions to transform channels
  </a>
  
    <nav class="md-nav" aria-label="Builtin verbs/functions to transform channels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#expanding-a-channel-by-directory-expand_dir" class="md-nav__link">
    Expanding a channel by directory: expand_dir()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collapsing-a-channel-by-files-in-a-common-ancestor-directory-collapse_files" class="md-nav__link">
    Collapsing a channel by files in a common ancestor directory: collapse_files(...)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../input-output/" class="md-nav__link">
        Input and output
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../script/" class="md-nav__link">
        Script
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../caching/" class="md-nav__link">
        Caching
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../error/" class="md-nav__link">
        Error handling
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../configurations/" class="md-nav__link">
        Configurations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../plugin/" class="md-nav__link">
        Plugins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../scheduler/" class="md-nav__link">
        Scheduler
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        Command line iterface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        Examples
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../CHANGELOG/" class="md-nav__link">
        Change log
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_17" type="checkbox" id="__nav_17" >
      
      <label class="md-nav__link" for="__nav_17">
        API
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_17">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_17_1" type="checkbox" id="__nav_17_1" >
      
      <label class="md-nav__link" for="__nav_17_1">
        pipen
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="pipen" data-md-level="2">
        <label class="md-nav__title" for="__nav_17_1">
          <span class="md-nav__icon md-icon"></span>
          pipen
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen/" class="md-nav__link">
        pipen
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen.proc/" class="md-nav__link">
        pipen.proc
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen.pluginmgr/" class="md-nav__link">
        pipen.pluginmgr
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen.pipen/" class="md-nav__link">
        pipen.pipen
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen.defaults/" class="md-nav__link">
        pipen.defaults
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen.template/" class="md-nav__link">
        pipen.template
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen.exceptions/" class="md-nav__link">
        pipen.exceptions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen.version/" class="md-nav__link">
        pipen.version
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen.progressbar/" class="md-nav__link">
        pipen.progressbar
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen.utils/" class="md-nav__link">
        pipen.utils
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_17_2" type="checkbox" id="__nav_17_2" >
      
      <label class="md-nav__link" for="__nav_17_2">
        pipen.cli
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="pipen.cli" data-md-level="2">
        <label class="md-nav__title" for="__nav_17_2">
          <span class="md-nav__icon md-icon"></span>
          pipen.cli
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen.cli/" class="md-nav__link">
        pipen.cli
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen.cli.help/" class="md-nav__link">
        pipen.cli.help
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen.cli.plugins/" class="md-nav__link">
        pipen.cli.plugins
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen.cli.profile/" class="md-nav__link">
        pipen.cli.profile
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen.scheduler/" class="md-nav__link">
        pipen.scheduler
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen.channel/" class="md-nav__link">
        pipen.channel
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/pipen.job/" class="md-nav__link">
        pipen.job
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creating-channels" class="md-nav__link">
    Creating channels
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#builtin-verbsfunctions-to-transform-channels" class="md-nav__link">
    Builtin verbs/functions to transform channels
  </a>
  
    <nav class="md-nav" aria-label="Builtin verbs/functions to transform channels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#expanding-a-channel-by-directory-expand_dir" class="md-nav__link">
    Expanding a channel by directory: expand_dir()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collapsing-a-channel-by-files-in-a-common-ancestor-directory-collapse_files" class="md-nav__link">
    Collapsing a channel by files in a common ancestor directory: collapse_files(...)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/pwwang/pipen/edit/master/docs/channels.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>Channels</h1>
                
                <p>Channels are used to pass data from one process to another. It is actually a <code>pandas.DataFrame</code> object, where each column corresponds to an input key and each row corresponds to a job.</p>
<p>The values for different variables in different jobs wil be:</p>
<table>
<thead>
<tr>
<th>Job Index</th>
<th>v1</th>
<th>v2</th>
<th>v3</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>a1</td>
<td>b1</td>
<td>c1</td>
</tr>
<tr>
<td>1</td>
<td>a2</td>
<td>b2</td>
<td>c2</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody>
</table>
<p>With a process definition:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyProcess</span><span class="p">(</span><span class="n">Proc</span><span class="p">):</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="s2">&quot;v1, v2, v3&quot;</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">df</span> <span class="c1">#  The above data frame</span>
</code></pre></div>
<p>Then:</p>
<table>
<thead>
<tr>
<th>Job index</th>
<th>Template</th>
<th>Rendered to</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td><code>{{in.v1}}</code></td>
<td><code>a1</code></td>
</tr>
<tr>
<td>0</td>
<td><code>{{in.v2}}</code></td>
<td><code>b1</code></td>
</tr>
<tr>
<td>0</td>
<td><code>{{in.v3}}</code></td>
<td><code>c1</code></td>
</tr>
<tr>
<td>1</td>
<td><code>{{in.v1}}</code></td>
<td><code>a2</code></td>
</tr>
<tr>
<td>1</td>
<td><code>{{in.v2}}</code></td>
<td><code>b2</code></td>
</tr>
<tr>
<td>1</td>
<td><code>{{in.v3}}</code></td>
<td><code>c2</code></td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody>
</table>
<p>The column names don't have to match the exact input keys. If <code>pipen</code> finds any of the input keys present in the data, just use them. However, if any input keys cannot find in the data frame, we will use the first couple of columns.</p>
<p>For example:
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyProcess2</span><span class="p">(</span><span class="n">Proc</span><span class="p">):</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="s2">&quot;v4, v3&quot;</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">df</span> <span class="c1">#  The above data frame</span>
</code></pre></div></p>
<p>The for job#0, <code>{{in.v4}}</code> will be rendered as <code>a1</code> (using column <code>v1</code> in the data), and <code>{{in.v3}}</code> as <code>c1</code> (using column <code>v3</code>).</p>
<h3 id="creating-channels">Creating channels</h3>
<p>Since channels are just data frames, so whatever creates a pandas data frame, can be used to create a channel. Besides, a couple of class methods are avaible to create channels:</p>
<ul>
<li>
<p><code>Channel.create(...)</code></p>
<p>This takes a list of values to create a channel. If a data frame is passed, will return that data frame.</p>
<p>If each element in the list is a tuple, the list is used to create a data frame directly, just like:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="n">ch</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">create</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)])</span>
<span class="c1"># ch = DataFrame([(1,2), (3,4)])</span>
<span class="c1">#         0       1</span>
<span class="c1">#   &lt;int64&gt; &lt;int64&gt;</span>
<span class="c1"># 0       1       2</span>
<span class="c1"># 1       3       4</span>
</code></pre></div>
<p>If each element is not a tuple (even it is a list), it is converted to tuple:
<div class="highlight"><pre><span></span><code><span class="n">ch</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">create</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="c1"># equvalent to:</span>
<span class="c1"># ch = Channel.create([(1, ), (2, )])</span>
</code></pre></div></p>
<p>The <code>input_data</code> is passed to this class method to create the input channel.</p>
</li>
<li>
<p><code>Channel.from_glob(...)</code></p>
<p>This takes a glob pattern to match the files to create a single-column channel.</p>
<p>You can also filter the types of files by <code>ftype</code>:
- <code>any</code>: to match any files (default)
- <code>link</code>: to mach any links
- <code>dir</code>: to match any directories
- <code>file</code>: to match any files</p>
<p>You may also sort the files using <code>sortby</code>:
- <code>name</code>: sort the files by their basename (default)
- <code>mtime</code>: sort the files by their last modified time
- <code>size</code>: sort by file size</p>
<p>When <code>reverse</code> is True, the above sortings are reversed.</p>
</li>
<li>
<p><code>Channel.from_pairs(...)</code></p>
<p>Like <code>Channel.from_glob()</code> but create a double-column channel.</p>
</li>
<li>
<p><code>Channel.from_csv(...)</code></p>
<p>Uses <code>pandas.read_csv()</code> to create a channel</p>
</li>
<li>
<p><code>Channel.from_excel(...)</code></p>
<p>Uses <code>pandas.read_excel()</code> to create a channel</p>
</li>
<li>
<p><code>Channel.from_table(...)</code></p>
<p>Uses <code>pandas.read_table()</code> to create a channel</p>
</li>
</ul>
<h3 id="builtin-verbsfunctions-to-transform-channels">Builtin verbs/functions to transform channels</h3>
<p><code>pipen</code> uses <a href="https://github.com/pwwang/pipda"><code>pipda</code></a> to create some verbs/functions to transform channels, so that you can use them with piping syntax:</p>
<div class="highlight"><pre><span></span><code><span class="n">channel</span> <span class="o">&gt;&gt;</span> <span class="n">verb</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></div>
<h4 id="expanding-a-channel-by-directory-expand_dir">Expanding a channel by directory: <code>expand_dir()</code></h4>
<p>Sometimes we prepare files in one process (for example, split a big file into small ones in a directory), then handle these files by different jobs in another process, so that they can be processed simultaneously.</p>
<p><img alt="channel.expand_dir" src="../channel-expand_dir.png" /></p>
<p>For example:
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">P1</span><span class="p">(</span><span class="n">Proc</span><span class="p">):</span>
    <span class="c1"># the original file: a.txt</span>
    <span class="nb">input</span>  <span class="o">=</span> <span class="s2">&quot;infile:file&quot;</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;a.txt&quot;</span><span class="p">]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;outdir:dir:outdir&quot;</span>
    <span class="n">script</span> <span class="o">=</span> <span class="s2">&quot;# the script to split a.txt to 1.txt, 2.txt, 3.txt ... to {{out.outdir}}&quot;</span>

<span class="k">class</span> <span class="nc">P2</span><span class="p">(</span><span class="n">Proc</span><span class="p">):</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="n">P1</span>
    <span class="c1"># expand channel [(&quot;outdir/a/&quot;,)] to channel:</span>
    <span class="c1"># [(&quot;outdir/a/1.txt&quot;,), (&quot;outdir/a/2.txt&quot;,), (&quot;outdir/a/3.txt&quot;,), ...]</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="s2">&quot;infile:file&quot;</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ch</span><span class="p">:</span> <span class="n">ch</span> <span class="o">&gt;&gt;</span> <span class="n">expand_dir</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;*.txt&quot;</span><span class="p">)</span>
    <span class="c1"># outfile: 1.result, 2.result, ...</span>
    <span class="n">output</span>  <span class="o">=</span> <span class="s2">&quot;outfile:file:{{in.infile.split(&#39;/&#39;)[-1].split(&#39;.&#39;)[0]}}.result&quot;</span>
    <span class="n">script</span>  <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    # work on {{in.infile}} (1.txt, 2.txt, 3.txt, ...)</span>
<span class="s2">    # to result file {{out.outfile}} (1.result, 2.result, 3.result, ...)</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="c1"># Run 3 jobs in a batch simultaneously</span>
<span class="n">Pipen</span><span class="p">(</span><span class="n">forks</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">P1</span><span class="p">)</span>
</code></pre></div></p>
<p>If the channel is a multi-column channel, you can also specify <code>col</code> to expand only on that column, values of other columns will be copied to the expanded rows/jobs.</p>
<p>You can also filter and sort the expanded files using arguments <code>ftype</code>, <code>sortby</code> and <code>reverse</code>, just like when we use <code>Channel.from_glob(...)</code></p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<ul>
<li><code>expand_dir(...)</code> only works for single-row channels, which will be expanded to <code>N</code> (number of files included). If original channel has more than 1 row, only first row will be used, and other rows will be ignored.</li>
<li>Only the value of the column to be expanded will be changed, values of other columns remain the same.</li>
</ul>
</div>
<h4 id="collapsing-a-channel-by-files-in-a-common-ancestor-directory-collapse_files">Collapsing a channel by files in a common ancestor directory: <code>collapse_files(...)</code></h4>
<p>It's basically the reverse process of <code>expand_dir()</code>. It applies when you deal with different files and in next process you need them all involved (i.e. combine the results):</p>
<p><img alt="channel.collapse_files" src="../channel-collapse_files.png" /></p>
<p>For example:
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">P1</span><span class="p">(</span><span class="n">Proc</span><span class="p">):</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="s2">&quot;infile:file&quot;</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;/a/b/1.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;/a/b/2.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;/a/b/3.txt&quot;</span><span class="p">]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;outfile:file:{{in.infile.split(&#39;/&#39;)[-1].split(&#39;.&#39;)[0] | append: &#39;.txt2&#39;}}&quot;</span>
    <span class="n">script</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    # the script to deal with each input file:</span>
<span class="s2">    # {{in.infile}} -&gt; {{out.outfile}}</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">P2</span><span class="p">(</span><span class="n">Proc</span><span class="p">):</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="n">P1</span>
    <span class="c1"># collapse channel [(&quot;&lt;outdir&gt;/1.txt2&quot;,), (&quot;&lt;outdir&gt;/2.txt2&quot;,), (&quot;&lt;outdir&gt;/3.txt2&quot;,)]</span>
    <span class="c1"># to channel: [(&quot;&lt;outdir&gt;/&quot;, )]</span>
    <span class="nb">input</span>   <span class="o">=</span> <span class="s2">&quot;indir:file&quot;</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ch</span><span class="p">:</span> <span class="n">ch</span> <span class="o">&gt;&gt;</span> <span class="n">collapse_files</span><span class="p">()</span>
    <span class="n">output</span>  <span class="o">=</span> <span class="s2">&quot;outfile:file:{{in.indir.split(&#39;/&#39;)[-1]}}.result&quot;</span>
    <span class="n">script</span>  <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    # combine 1.txt2, 2.txt2, 3.txt3 in {{in.indir}} to {{out.outfile}}</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="n">Pipen</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">P1</span><span class="p">)</span>
</code></pre></div></p>
<p>Similarly, if we have multiple columns, you may specify the column by index or name to collapse by:
<code>ch &gt;&gt; collapse_files(col=...)</code></p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<ul>
<li><code>os.path.dirname(os.path.commonprefix(...))</code> is used to detect the common ancestor directory, so the files could be <code>['/a/1/1.file', '/a/2/1.file']</code>. In this case <code>/a/</code> will be returned.</li>
<li>values at other columns should be the same. They will NOT be checked! The values at the first row will be used.</li>
</ul>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../templating/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Templating" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Templating
            </div>
          </div>
        </a>
      
      
        
        <a href="../input-output/" class="md-footer__link md-footer__link--next" aria-label="Next: Input and output" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Input and output
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.2b46852b.min.js"></script>
      
        <script src="../js/mkapi.js"></script>
      
    
  </body>
</html>